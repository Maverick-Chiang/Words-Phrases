<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no" />
  <title>字卡學習工具</title>
  <style>
    * { 
      box-sizing: border-box; 
      -webkit-tap-highlight-color: transparent;
      -webkit-touch-callout: none;
      -webkit-user-select: none;
      -khtml-user-select: none;
      -moz-user-select: none;
      -ms-user-select: none;
      user-select: none;
    }
    
    body { 
      margin: 0; 
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: #fff; 
      height: 100vh; 
      overflow: hidden;
      position: fixed;
      width: 100%;
      touch-action: manipulation;
    }

    .header {
      background: rgba(0,0,0,0.2);
      backdrop-filter: blur(10px);
      padding: 15px 20px;
      display: flex;
      justify-content: center;
      align-items: center;
      position: relative;
      z-index: 100;
    }

    .title {
      font-size: 20px;
      font-weight: 600;
      color: white;
    }

    .menu-btn {
      background: rgba(255,255,255,0.2);
      border: none;
      border-radius: 8px;
      padding: 10px;
      color: white;
      font-size: 18px;
      cursor: pointer;
      transition: all 0.2s;
      position: absolute;
      left: 20px;
    }

    .menu-btn:active {
      background: rgba(255,255,255,0.3);
      transform: scale(0.95);
    }

    .main-content {
      flex: 1;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      padding: 20px;
      height: calc(100vh - 80px);
      position: relative;
    }

    .card {
      background: rgba(255,255,255,0.95);
      backdrop-filter: blur(20px);
      border: 1px solid rgba(255,255,255,0.3);
      padding: 40px 30px;
      border-radius: 20px;
      width: 100%;
      max-width: 320px;
      min-height: 200px;
      text-align: center;
      font-size: 24px;
      font-weight: 500;
      cursor: pointer;
      transition: all 0.3s ease;
      display: flex;
      align-items: center;
      justify-content: center;
      flex-direction: column;
      box-shadow: 0 8px 32px rgba(0,0,0,0.1);
      margin-bottom: 30px;
    }

    .card:active {
      transform: scale(0.98);
      background: rgba(255,255,255,0.98);
    }

    .card-content {
      line-height: 1.4;
      color: #000000;
    }

    .nav-buttons {
      display: flex;
      justify-content: space-between;
      width: 100%;
      max-width: 320px;
      gap: 20px;
    }

    .nav-button {
      background: rgba(0,0,0,0.3);
      border: none;
      border-radius: 50%;
      width: 60px;
      height: 60px;
      font-size: 24px;
      color: white;
      cursor: pointer;
      transition: all 0.2s;
      display: flex;
      align-items: center;
      justify-content: center;
      backdrop-filter: blur(10px);
    }

    .nav-button:active {
      transform: scale(0.9);
      background: rgba(0,0,0,0.5);
    }

    .add-btn {
      position: fixed;
      bottom: 30px;
      right: 30px;
      background: linear-gradient(45deg, #ff6b6b, #ee5a52);
      border: none;
      border-radius: 50%;
      width: 60px;
      height: 60px;
      font-size: 30px;
      color: white;
      cursor: pointer;
      z-index: 1000;
      box-shadow: 0 4px 20px rgba(238, 90, 82, 0.4);
      transition: all 0.2s;
    }

    .add-btn:active {
      transform: scale(0.9);
    }

    .sidebar {
      position: fixed;
      top: 0;
      left: -100%;
      width: 85%;
      max-width: 300px;
      height: 100vh;
      background: rgba(0,0,0,0.9);
      backdrop-filter: blur(20px);
      z-index: 1000;
      transition: left 0.3s ease;
      overflow-y: auto;
      padding-top: 80px;
    }

    .sidebar.open {
      left: 0;
    }

    .sidebar-overlay {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0,0,0,0.5);
      z-index: 999;
      opacity: 0;
      visibility: hidden;
      transition: all 0.3s;
    }

    .sidebar-overlay.show {
      opacity: 1;
      visibility: visible;
    }

    .section-item {
      padding: 15px 20px;
      border-bottom: 1px solid rgba(255,255,255,0.1);
      cursor: pointer;
      display: flex;
      justify-content: space-between;
      align-items: center;
      position: relative;
    }

    .section-item:active {
      background: rgba(255,255,255,0.1);
    }

    .section-name {
      font-size: 16px;
      font-weight: 500;
      flex: 1;
    }

    .section-count {
      background: rgba(255,255,255,0.2);
      padding: 4px 8px;
      border-radius: 12px;
      font-size: 12px;
      margin-right: 10px;
    }

    .section-actions {
      display: flex;
      gap: 5px;
    }

    .section-btn {
      background: rgba(255,255,255,0.2);
      border: none;
      border-radius: 4px;
      padding: 5px 8px;
      color: white;
      font-size: 12px;
      cursor: pointer;
    }

    .section-btn:active {
      background: rgba(255,255,255,0.3);
    }

    .modal {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0,0,0,0.8);
      z-index: 2000;
      display: none;
      align-items: center;
      justify-content: center;
      padding: 20px;
    }

    .modal-content {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      border-radius: 20px;
      padding: 30px;
      width: 100%;
      max-width: 400px;
      max-height: 80vh;
      overflow-y: auto;
    }

    .modal-title {
      font-size: 20px;
      font-weight: 600;
      margin-bottom: 20px;
      text-align: center;
    }

    .input-group {
      margin-bottom: 20px;
    }

    .input-group input {
      width: 100%;
      padding: 15px;
      border: none;
      border-radius: 10px;
      font-size: 16px;
      background: rgba(255,255,255,0.9);
      color: #333;
    }

    .input-group input::placeholder {
      color: #666;
    }

    .modal-buttons {
      display: flex;
      gap: 10px;
      margin-top: 20px;
    }

    .modal-btn {
      flex: 1;
      padding: 15px;
      border: none;
      border-radius: 10px;
      font-size: 16px;
      font-weight: 500;
      cursor: pointer;
      transition: all 0.2s;
    }

    .modal-btn.primary {
      background: #4CAF50;
      color: white;
    }

    .modal-btn.secondary {
      background: rgba(255,255,255,0.2);
      color: white;
    }

    .modal-btn:active {
      transform: scale(0.98);
    }

    .card-list {
      padding: 20px;
    }

    .card-list-item {
      background: rgba(255,255,255,0.1);
      margin-bottom: 10px;
      padding: 15px;
      border-radius: 10px;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .card-info {
      flex: 1;
    }

    .card-english {
      font-weight: 600;
      margin-bottom: 5px;
    }

    .card-chinese {
      font-size: 14px;
      opacity: 0.8;
    }

    .card-actions {
      display: flex;
      gap: 10px;
    }

    .action-btn {
      background: rgba(255,255,255,0.2);
      border: none;
      border-radius: 6px;
      padding: 8px;
      color: white;
      font-size: 14px;
      cursor: pointer;
    }

    .action-btn:active {
      background: rgba(255,255,255,0.3);
    }

    .progress-indicator {
      position: absolute;
      bottom: 10px;
      left: 50%;
      transform: translateX(-50%);
      font-size: 14px;
      opacity: 0.7;
    }

    .toast {
      position: fixed;
      bottom: 100px;
      left: 50%;
      transform: translateX(-50%);
      background: rgba(0,0,0,0.8);
      color: white;
      padding: 12px 20px;
      border-radius: 25px;
      font-size: 14px;
      z-index: 3000;
      opacity: 0;
      transition: all 0.3s;
    }

    .toast.show {
      opacity: 1;
    }

    .empty-state {
      text-align: center;
      opacity: 0.9;
      padding: 40px 20px;
      color: #000000;
    }

    .empty-state h3 {
      margin-bottom: 10px;
      font-size: 18px;
      color: #000000;
    }

    .empty-state p {
      font-size: 14px;
      line-height: 1.5;
      color: #000000;
    }
  </style>
</head>
<body>
  <div class="header">
    <button class="menu-btn" id="menuBtn">☰</button>
    <div class="title">字卡學習</div>
  </div>

  <div class="main-content">
    <div class="card" id="card">
      <div class="card-content" id="cardContent">
        <div class="empty-state">
          <h3>歡迎使用字卡學習工具</h3>
          <p>點擊左上角選單選擇分類<br>或點擊右下角新增單字</p>
        </div>
      </div>
    </div>
    
    <div class="nav-buttons">
      <button class="nav-button" id="prevBtn">←</button>
      <button class="nav-button" id="nextBtn">→</button>
    </div>
    
    <div class="progress-indicator" id="progress"></div>
  </div>

  <div class="sidebar-overlay" id="sidebarOverlay"></div>
  <div class="sidebar" id="sidebar">
    <div id="sectionList"></div>
  </div>

  <button class="add-btn" id="addBtn">+</button>

  <div class="modal" id="addModal">
    <div class="modal-content">
      <div class="modal-title" id="modalTitle">新增單字</div>
      <div class="input-group">
        <input type="text" id="sectionInput" placeholder="分類（例如：日常用語）" />
      </div>
      <div class="input-group">
        <input type="text" id="englishInput" placeholder="英文單字" />
      </div>
      <div class="input-group">
        <input type="text" id="chineseInput" placeholder="中文解釋" />
      </div>
      <div class="modal-buttons">
        <button class="modal-btn secondary" id="cancelBtn">取消</button>
        <button class="modal-btn primary" id="saveBtn">儲存</button>
      </div>
    </div>
  </div>

  <div class="modal" id="listModal">
    <div class="modal-content">
      <div class="modal-title" id="listModalTitle">單字列表</div>
      <div class="card-list" id="cardListContent"></div>
      <div class="modal-buttons">
        <button class="modal-btn primary" id="closeListBtn">關閉</button>
      </div>
    </div>
  </div>

  <div class="toast" id="toast"></div>

<script>
// 全域變數
let flashcards = [];
let currentSection = "";
let currentIndex = 0;
let currentCards = [];
let viewState = 0; // 0: 英文, 1: 中文, 2: 雙語
let editingCardId = null;

// 儲存鍵名
const STORAGE_KEY = 'flashcards_data_v1';

// DOM 元素
const menuBtn = document.getElementById('menuBtn');
const card = document.getElementById('card');
const cardContent = document.getElementById('cardContent');
const prevBtn = document.getElementById('prevBtn');
const nextBtn = document.getElementById('nextBtn');
const progress = document.getElementById('progress');
const sidebar = document.getElementById('sidebar');
const sidebarOverlay = document.getElementById('sidebarOverlay');
const sectionList = document.getElementById('sectionList');
const addBtn = document.getElementById('addBtn');
const addModal = document.getElementById('addModal');
const listModal = document.getElementById('listModal');
const modalTitle = document.getElementById('modalTitle');
const sectionInput = document.getElementById('sectionInput');
const englishInput = document.getElementById('englishInput');
const chineseInput = document.getElementById('chineseInput');
const cancelBtn = document.getElementById('cancelBtn');
const saveBtn = document.getElementById('saveBtn');
const listModalTitle = document.getElementById('listModalTitle');
const cardListContent = document.getElementById('cardListContent');
const closeListBtn = document.getElementById('closeListBtn');
const toast = document.getElementById('toast');

// 儲存資料到 localStorage
function saveData() {
  try {
    localStorage.setItem(STORAGE_KEY, JSON.stringify(flashcards));
    console.log('資料已儲存:', flashcards.length, '張卡片');
  } catch (e) {
    console.error('儲存失敗:', e);
    showToast('儲存失敗');
  }
}

// 從 localStorage 載入資料
function loadData() {
  try {
    const data = localStorage.getItem(STORAGE_KEY);
    if (data) {
      flashcards = JSON.parse(data);
      console.log('載入資料:', flashcards.length, '張卡片');
    } else {
      flashcards = [];
      console.log('沒有儲存的資料');
    }
  } catch (e) {
    console.error('載入失敗:', e);
    flashcards = [];
  }
}

// 顯示提示訊息
function showToast(message, duration = 2000) {
  toast.textContent = message;
  toast.classList.add('show');
  setTimeout(() => {
    toast.classList.remove('show');
  }, duration);
}

// 側邊欄控制
function toggleSidebar() {
  if (sidebar.classList.contains('open')) {
    closeSidebar();
  } else {
    openSidebar();
  }
}

function openSidebar() {
  sidebar.classList.add('open');
  sidebarOverlay.classList.add('show');
  renderSectionList();
}

function closeSidebar() {
  sidebar.classList.remove('open');
  sidebarOverlay.classList.remove('show');
}

// 渲染分類列表
function renderSectionList() {
  sectionList.innerHTML = '';
  
  if (flashcards.length === 0) {
    sectionList.innerHTML = `
      <div style="padding: 20px; text-align: center; opacity: 0.8;">
        <p>還沒有任何單字<br>點擊右下角新增第一個單字</p>
      </div>
    `;
    return;
  }
  
  // 整理分類
  const sections = {};
  flashcards.forEach(card => {
    if (!sections[card.section]) {
      sections[card.section] = [];
    }
    sections[card.section].push(card);
  });
  
  // 顯示分類
  Object.keys(sections).sort().forEach(sectionName => {
    const sectionDiv = document.createElement('div');
    sectionDiv.className = 'section-item';
    
    sectionDiv.innerHTML = `
      <div class="section-name">${sectionName}</div>
      <div class="section-count">${sections[sectionName].length}</div>
      <div class="section-actions">
        <button class="section-btn" onclick="viewSectionCards('${sectionName}')">列表</button>
        <button class="section-btn" onclick="deleteSection('${sectionName}')">刪除</button>
      </div>
    `;
    
    // 點擊分類名稱選擇分類
    sectionDiv.querySelector('.section-name').addEventListener('click', () => {
      selectSection(sectionName);
      closeSidebar();
    });
    
    sectionList.appendChild(sectionDiv);
  });
}

// 選擇分類
function selectSection(sectionName) {
  currentSection = sectionName;
  currentCards = flashcards.filter(card => card.section === sectionName);
  currentIndex = 0;
  viewState = 0;
  
  updateCardDisplay();
  updateProgress();
}

// 更新卡片顯示
function updateCardDisplay() {
  if (currentCards.length === 0) {
    cardContent.innerHTML = `
      <div class="empty-state">
        <h3>選擇一個分類開始學習</h3>
        <p>點擊左上角選單選擇分類</p>
      </div>
    `;
    return;
  }
  
  const currentCard = currentCards[currentIndex];
  
  let content = '';
  switch (viewState) {
    case 0:
      content = `<div style="font-size: 28px; font-weight: 600; color: #000000;">${currentCard.english}</div>`;
      break;
    case 1:
      content = `<div style="font-size: 24px; color: #000000;">${currentCard.chinese}</div>`;
      break;
    case 2:
      content = `
        <div style="font-size: 24px; font-weight: 600; margin-bottom: 15px; color: #000000;">${currentCard.english}</div>
        <div style="font-size: 20px; opacity: 0.8; color: #000000;">${currentCard.chinese}</div>
      `;
      break;
  }
  
  cardContent.innerHTML = content;
}

// 更新進度顯示
function updateProgress() {
  if (currentCards.length > 0) {
    progress.textContent = `${currentIndex + 1} / ${currentCards.length}`;
    progress.style.display = 'block';
  } else {
    progress.style.display = 'none';
  }
}

// 卡片翻轉
function flipCard() {
  if (currentCards.length === 0) return;
  viewState = (viewState + 1) % 3;
  updateCardDisplay();
}

// 上一張卡片
function prevCard() {
  if (currentCards.length === 0) return;
  currentIndex = (currentIndex - 1 + currentCards.length) % currentCards.length;
  viewState = 0;
  updateCardDisplay();
  updateProgress();
}

// 下一張卡片
function nextCard() {
  if (currentCards.length === 0) return;
  currentIndex = (currentIndex + 1) % currentCards.length;
  viewState = 0;
  updateCardDisplay();
  updateProgress();
}

// 新增單字對話框
function openAddModal() {
  modalTitle.textContent = '新增單字';
  addModal.style.display = 'flex';
  editingCardId = null;
  clearForm();
}

function closeAddModal() {
  addModal.style.display = 'none';
}

function clearForm() {
  sectionInput.value = '';
  englishInput.value = '';
  chineseInput.value = '';
}

// 儲存單字
function saveCard() {
  const section = sectionInput.value.trim();
  const english = englishInput.value.trim();
  const chinese = chineseInput.value.trim();
  
  if (!section || !english || !chinese) {
    showToast('請填寫所有欄位');
    return;
  }
  
  if (editingCardId) {
    // 編輯現有單字
    const cardIndex = flashcards.findIndex(card => card.id === editingCardId);
    if (cardIndex > -1) {
      flashcards[cardIndex] = {
        ...flashcards[cardIndex],
        section: section,
        english: english,
        chinese: chinese,
        updatedAt: Date.now()
      };
      showToast('單字已更新');
    }
  } else {
    // 新增單字
    const newCard = {
      id: Date.now().toString() + Math.random().toString(36).substr(2, 9),
      section: section,
      english: english,
      chinese: chinese,
      createdAt: Date.now()
    };
    flashcards.push(newCard);
    showToast('單字已新增');
  }
  
  saveData();
  closeAddModal();
  
  // 如果是新增到當前分類，更新顯示
  if (section === currentSection) {
    selectSection(section);
  }
}

// 查看分類單字列表
function viewSectionCards(sectionName) {
  const sectionCards = flashcards.filter(card => card.section === sectionName);
  
  listModalTitle.textContent = `${sectionName} (${sectionCards.length}個單字)`;
  cardListContent.innerHTML = '';
  
  sectionCards.forEach(card => {
    const cardDiv = document.createElement('div');
    cardDiv.className = 'card-list-item';
    cardDiv.innerHTML = `
      <div class="card-info">
        <div class="card-english">${card.english}</div>
        <div class="card-chinese">${card.chinese}</div>
      </div>
      <div class="card-actions">
        <button class="action-btn" onclick="editCard('${card.id}')">編輯</button>
        <button class="action-btn" onclick="deleteCard('${card.id}')">刪除</button>
      </div>
    `;
    cardListContent.appendChild(cardDiv);
  });
  
  listModal.style.display = 'flex';
  closeSidebar();
}

function closeListModal() {
  listModal.style.display = 'none';
}

// 編輯單字
function editCard(cardId) {
  const cardData = flashcards.find(c => c.id === cardId);
  if (cardData) {
    sectionInput.value = cardData.section;
    englishInput.value = cardData.english;
    chineseInput.value = cardData.chinese;
    modalTitle.textContent = '編輯單字';
    editingCardId = cardId;
    closeListModal();
    addModal.style.display = 'flex';
  }
}

// 刪除單字
function deleteCard(cardId) {
  if (confirm('確定要刪除這個單字嗎？')) {
    const cardToDelete = flashcards.find(c => c.id === cardId);
    flashcards = flashcards.filter(card => card.id !== cardId);
    saveData();
    showToast('單字已刪除');
    
    // 重新顯示列表
    if (cardToDelete) {
      viewSectionCards(cardToDelete.section);
    }
    
    // 如果刪除的是當前分類的單字，更新顯示
    if (currentSection === cardToDelete.section) {
      selectSection(currentSection);
    }
  }
}

// 刪除整個分類
function deleteSection(sectionName) {
  if (confirm(`確定要刪除整個分類「${sectionName}」嗎？這將刪除該分類下的所有單字。`)) {
    flashcards = flashcards.filter(card => card.section !== sectionName);
    saveData();
    showToast('分類已刪除');
    
    // 如果刪除的是當前分類，重置顯示
    if (currentSection === sectionName) {
      currentSection = '';
      currentCards = [];
      updateCardDisplay();
      updateProgress();
    }
    
    renderSectionList();
  }
}

// 觸控手勢
let touchStartX = 0;
let touchStartY = 0;

// 事件監聽器
function initEventListeners() {
  // 選單按鈕
  menuBtn.addEventListener('click', toggleSidebar);
  
  // 側邊欄遮罩
  sidebarOverlay.addEventListener('click', closeSidebar);
  
  // 卡片點擊翻轉
  card.addEventListener('click', flipCard);
  
  // 導航按鈕
  prevBtn.addEventListener('click', prevCard);
  nextBtn.addEventListener('click', nextCard);
  
  // 新增按鈕
  addBtn.addEventListener('click', openAddModal);
  
  // 模態框按鈕
  cancelBtn.addEventListener('click', closeAddModal);
  saveBtn.addEventListener('click', saveCard);
  closeListBtn.addEventListener('click', closeListModal);
  
  // 觸控手勢
  card.addEventListener('touchstart', (e) => {
    touchStartX = e.touches[0].clientX;
    touchStartY = e.touches[0].clientY;
  });
  
  card.addEventListener('touchend', (e) => {
    const touchEndX = e.changedTouches[0].clientX;
    const touchEndY = e.changedTouches[0].clientY;
    const deltaX = touchEndX - touchStartX;
    const deltaY = touchEndY - touchStartY;
    
    // 檢查是否為水平滑動
    if (Math.abs(deltaX) > Math.abs(deltaY) && Math.abs(deltaX) > 50) {
      if (deltaX > 0) {
        prevCard(); // 向右滑動 - 上一張
      } else {
        nextCard(); // 向左滑動 - 下一張
      }
      e.preventDefault();
    }
  });
}

// 初始化應用程式
function initApp() {
  console.log('初始化應用程式');
  loadData();
  initEventListeners();
  updateCardDisplay();
  updateProgress();
  console.log('初始化完成，資料:', flashcards.length, '張卡片');
}

// 確保在頁面載入完成後初始化
document.addEventListener('DOMContentLoaded', initApp);

// 確保全域函數可用
window.viewSectionCards = viewSectionCards;
window.deleteSection = deleteSection;
window.editCard = editCard;
window.deleteCard = deleteCard;
</script>
</body>
</html>